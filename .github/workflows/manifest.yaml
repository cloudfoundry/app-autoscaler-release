name: Manifest Tests
on:
  pull_request:
    paths:
      - 'templates/**'
      - 'jobs/**'
      - 'packages/**'

concurrency:
  group: "${{ github.workflow }}/${{ github.ref }}"
  cancel-in-progress: true

defaults:
  run:
    shell: bash

jobs:
  test_manifest:
    name: Manifest Tests
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/cloudfoundry/app-autoscaler-release-tools:main@sha256:5051e58cc3f83830238ed3185277f884f03a87c92c5e14f355038d9b2f9add8c
    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5

      - name: Run Tests - Manifest
        run: |
          set -e

          pushd templates
            MANIFEST_PATH=$PWD/app-autoscaler.yml \
            OPERATION_DIR_PATH=$PWD/../operations \
            ./manifest_tests.sh
          popd

